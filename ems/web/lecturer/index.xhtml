<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"   
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      >
    <h:head></h:head>

    <h:body>

        <ui:composition template="../template/mainLayout.xhtml">
            <ui:define name="content">



                <h2>Question Management</h2>

                <h:form id="form">
                    <p:messages/>
                    <p:commandButton value="Create Question" type="button"  onclick="PF('createQuestionDialog').show();" /> 
                    
                    <p:selectOneMenu id="moduleDropDown1" value="#{questionController.moduleSelected.moduleName}" style="width:150px" required="true" >
                        <p:ajax listener="#{questionController.retrieveQuestions()}"  update="questionDataTable" />
                        <f:selectItems value="#{questionController.retrieveModules()}" />
                    </p:selectOneMenu>

                    <p:dataTable id="questionDataTable" value="#{questionController.retrieveQuestions()}" var="question" paginator="true" >
                        <p:column headerText="Question Text">
                            <p:outputLabel value="#{question.questionText}" escape="false"/>
                        </p:column>
                        <p:column headerText="Question Type">
                            <p:outputLabel value="#{question.questionType.label}" />
                        </p:column>
                        <p:column headerText="Created By">
                            <p:outputLabel value="#{question.createdBy.lecturerName}" />
                        </p:column>
                        <p:column headerText="Created On">
                            <p:outputLabel value="#{question.createdOn}" />
                        </p:column>
                        <p:column >
                            <p:commandButton value="Modify" action="#{questionController.setQuestionSelected(question)}" process="@this" oncomplete="PF('createQuestionDialog').show();" />
                        </p:column>
                        <p:column >
                            <p:commandButton value="Depreciate" action="#{questionController.setQuestionSelected(question)}" process="@this" oncomplete="PF('createQuestionDialog').show();" />
                        </p:column>
                    </p:dataTable>

                    <p:dialog header="Create Question" widgetVar="createQuestionDialog" minHeight="40" height="500" width="500">

                        <p:messages/>
                        <h:panelGrid columns="2" cellpadding="5">
                            <p:outputLabel for="moduleDropDown" value="Select Module :" />
                            <p:selectOneMenu id="moduleDropDown" value="#{questionController.moduleSelected.moduleName}" style="width:150px" required="true" >
                                <f:selectItems value="#{questionController.modules}" />
                            </p:selectOneMenu>
                            <p:outputLabel for="subjectTagDropDown" value="Select Subject :" />
                            <p:selectManyMenu id="subjectTagDropDown" value="#{questionController.subjectTagsSelected}" filter="true" filterMatchMode="contains" showCheckbox="true" required="true">
                                <f:selectItems value="#{questionController.retrieveSubjectTags()}" />
                            </p:selectManyMenu>

                            <p:outputLabel for="questionTypeDropDown" value="Select Question Type :" />
                            <p:selectOneMenu id="questionTypeDropDown" value="#{questionController.questionType}" required="true">
                                <p:ajax  update="questionPG" />
                                <f:selectItems value="#{questionController.questionTypes}" />
                            </p:selectOneMenu>


                        </h:panelGrid>

                        <h:panelGroup id="questionPG" >

                            <p:panelGrid columns="1" rendered="#{questionController.questionType.label=='MCQ One Correct'}">

                                <h:panelGroup>
                                    <p:outputLabel for="questionText" value="Question :" />

                                    <p:editor id="questionText"  value="#{questionController.questionText}" width="600" required="true" requiredMessage="Question Text is required"/>
                                    <p:message for="questionText" />
                                </h:panelGroup>

                                <h:panelGroup>
                                    <p:outputLabel for="markInputText" value="Mark"/>
                                    <p:inputText id="markInputText" value="#{questionController.mark}" required="true" requiredMessage="Mark is required"/>
                                    <p:message for="markInputText" />
                                </h:panelGroup>

                                <h:panelGroup>
                                    <p:commandButton  value="Add" actionListener="#{questionController.addOption(questionController.option)}" process="@this,optionInputText" update="questionOptionDataTable,optionInputText"   />

                                    <p:inputText id="optionInputText" value="#{questionController.option}" required="true"/>
                                </h:panelGroup>
                                <p:dataTable id="questionOptionDataTable" value="#{questionController.options}" var="option">
                                    <p:column headerText="Options">
                                        <h:outputText value="#{option}" />
                                        <p:commandButton value="Remove" action="#{questionController.removeOption(option)}" process="@this" update="questionOptionDataTable"/>
                                    </p:column>
                                </p:dataTable>


                            </p:panelGrid>

                            <p:outputLabel value="MCQ Multiple Correct" rendered="#{questionController.questionType.label=='MCQ Multiple Correct'}"/>
                            <p:outputLabel value="Essay" rendered="#{questionController.questionType.label=='Essay'}"/>
                            <p:outputLabel value="Multi Part" rendered="#{questionController.questionType.label=='Multi Part'}"/>

                            <p:commandButton value="Create Question" action="#{questionController.createQuestion}" process="@this,moduleDropDown,subjectTagDropDown,questionTypeDropDown,questionText,markInputText" update="form"/>
                        </h:panelGroup>

                    </p:dialog>


                    
                    
                    




                </h:form>   			
            </ui:define>

        </ui:composition>

    </h:body>

</html>



